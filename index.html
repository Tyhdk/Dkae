<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <title>Sky Miner - ØªØ¹Ø¯ÙŠÙ† Ø³Ø­Ø§Ø¨ÙŠ ÙˆØ§Ø³ØªØ«Ù…Ø§Ø± USDT</title>
  <meta name="description" content="Ù…Ù†ØµØ© Ø³ÙƒØ§ÙŠ Ù…Ø§ÙŠÙ†Ø± (Sky Miner) Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ† Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ. Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¯Ø®Ù„ ÙŠÙˆÙ…ÙŠ Ù…Ø¶Ù…ÙˆÙ† Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± USDT. Ø³Ø­Ø¨ ÙÙˆØ±ÙŠØŒ Ø¨Ø§Ù‚Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø©ØŒ ÙˆÙ†Ø¸Ø§Ù… Ø¢Ù…Ù†.">
  <meta name="keywords" content="ØªØ¹Ø¯ÙŠÙ†, Ø§Ø³ØªØ«Ù…Ø§Ø±, Ø±Ø¨Ø­ Ù…Ù† Ø§Ù„Ø§Ù†ØªØ±Ù†Øª, USDT, ØªØ¹Ø¯ÙŠÙ† Ø³Ø­Ø§Ø¨ÙŠ, Sky Miner, Ø§Ø³ØªØ«Ù…Ø§Ø± Ù…Ø¶Ù…ÙˆÙ†, Ø¹Ù…Ù„Ø§Øª Ø±Ù‚Ù…ÙŠØ©, TRC20, Ù…Ù†ØµØ© Ø§Ø³ØªØ«Ù…Ø§Ø±">
  <meta name="robots" content="index, follow">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <style>
    /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ø®Ø·ÙˆØ· */
    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
    
    body {
      font-family: 'Cairo', sans-serif;
      background: radial-gradient(circle at top, #1e293b, #020617);
      color: #f9fafb;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .app-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      padding-bottom: 90px;
      scroll-behavior: smooth;
    }

    .page-section { display: none; }
    .page-section.active { display: block; animation: fadeInUp 0.5s ease-in-out; }

    /* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ø¹Ø§Ø¦Ù… - ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù„ÙŠØ³Ø¹ 5 Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
    .bottom-nav {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 95%; /* ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ø¹Ø±Ø¶ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      height: 65px;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #64748b;
      font-size: 9px; /* ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      cursor: pointer;
      width: 20%; /* ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ 5 Ø¹Ù†Ø§ØµØ± */
      height: 100%;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .nav-item.active { color: #22c55e; transform: translateY(-5px); font-weight: bold; }
    .nav-icon { font-size: 20px; margin-bottom: 2px; }

    /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    .card {
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      padding: 18px;
      margin-bottom: 18px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }
    .card h2 { font-size: 17px; margin-bottom: 10px; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    .muted { font-size: 12px; color: #94a3b8; line-height: 1.6; }
    
    /* Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
    .field { margin-bottom: 14px; }
    .field label { font-size: 13px; margin-bottom: 6px; display: block; color: #cbd5e1; font-weight: 600; }
    .field input, .field textarea {
      width: 100%; padding: 12px 14px; border-radius: 12px;
      border: 2px solid #334155; background: #0f172a; color: #fff;
      font-size: 14px; font-family: inherit; text-align: right;
      transition: all 0.3s; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }
    .field input:focus, .field textarea:focus { border-color: #22c55e; box-shadow: 0 0 15px rgba(34, 197, 94, 0.3); transform: scale(1.01); }
    input[readonly] { background: rgba(30, 41, 59, 0.5); color: #fbbf24; border-color: #fbbf24; cursor: copy; }

    button {
      border: none; border-radius: 12px; padding: 12px; font-size: 15px;
      cursor: pointer; font-family: inherit; width: 100%; font-weight: 700;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      position: relative; transition: all 0.1s; text-transform: uppercase;
    }
    .btn-main { background: linear-gradient(to bottom, #22c55e, #16a34a); color: #fff; box-shadow: 0 4px 0 #14532d; }
    .btn-main:active { transform: translateY(4px); box-shadow: none; }
    .btn-secondary { background: #334155; color: #e2e8f0; box-shadow: 0 4px 0 #1e293b; }
    .btn-secondary:active { transform: translateY(4px); box-shadow: none; }
    .btn-danger { background: linear-gradient(to bottom, #ef4444, #dc2626); color: #fff; box-shadow: 0 4px 0 #991b1b; }
    .btn-danger:active { transform: translateY(4px); box-shadow: none; }

    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 6px; }
    .user-badge { background: rgba(30, 41, 59, 0.8); padding: 6px 14px; border-radius: 30px; font-size: 13px; border: 1px solid #334155; }
    .wallet-box { text-align: center; padding: 25px 0; background: radial-gradient(circle, #0f172a 0%, #020617 100%); }
    .wallet-amount { font-size: 40px; font-weight: 800; color: #4ade80; direction: ltr; margin-top: 5px;}
    .plans-grid { display: grid; gap: 14px; }
    .plan-card { background: rgba(15, 23, 42, 0.8); border: 1px solid #334155; padding: 14px; border-radius: 16px; display: flex; gap: 14px; align-items: center; transition: transform 0.2s; }
    .plan-media { width: 65px; height: 65px; border-radius: 12px; object-fit: cover; background: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
    .plan-info { flex: 1; }
    .plan-title { font-weight: bold; font-size: 15px; margin-bottom: 6px; color: #fff; }
    .plan-details { font-size: 11px; color: #cbd5e1; display: flex; gap: 10px; background: #1e293b; padding: 4px 8px; border-radius: 6px; width: fit-content; }
    .invest-item { background: rgba(2, 6, 23, 0.8); border: 1px solid #334155; padding: 16px; border-radius: 14px; margin-bottom: 12px; position: relative; overflow: hidden; }
    .invest-item::before { content: ''; position: absolute; left: 0; top: 0; width: 4px; height: 100%; background: #22c55e; }
    #authScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #020617; z-index: 2000; padding: 25px; display: flex; flex-direction: column; justify-content: center; }
    
    /* ØªÙ†Ø³ÙŠÙ‚ ØµÙØ­Ø© Ù…Ù† Ù†Ø­Ù† */
    .about-feature { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; background: rgba(255,255,255,0.03); padding: 10px; border-radius: 12px; }
    .about-icon { width: 40px; height: 40px; background: rgba(34, 197, 94, 0.1); color: #22c55e; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
  </style>
</head>
<body>

  <div id="authScreen" class="animate__animated animate__fadeIn" style="display:none;">
    <div style="text-align:center; margin-bottom:30px;">
      <h1 class="animate__animated animate__bounceInDown" style="color:#22c55e; margin-bottom:10px; font-size: 28px;">Sky Miner</h1>
      <p class="muted">Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
    </div>
    
    <div class="field animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
      <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <input type="email" id="authEmail" style="text-align:left; direction:ltr;" />
    </div>
    <div class="field animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input type="password" id="authPassword" style="text-align:left; direction:ltr;" />
    </div>
    <div class="field animate__animated animate__fadeInUp" id="nameFieldBox" style="display:none; animation-delay: 0.2s;">
      <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
      <input type="text" id="authName" />
    </div>
    <div class="animate__animated animate__fadeInUp" style="animation-delay: 0.3s;">
      <button id="loginBtn" class="btn-main" style="margin-bottom:12px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <button id="showRegisterBtn" class="btn-secondary">Ù„ÙŠØ³ Ù„Ø¯ÙŠ Ø­Ø³Ø§Ø¨ØŸ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙŠØ¯</button>
      <button id="doRegisterBtn" class="btn-main" style="display:none; margin-bottom:12px;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
      <button id="backToLoginBtn" class="btn-secondary" style="display:none;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>
    <p id="authMsg" style="text-align:center; margin-top:15px; font-size:13px;"></p>
  </div>

  <div class="app-content">
    <div class="header-top animate__animated animate__fadeInDown">
      <div><h2 style="font-size:18px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="userNameTag" style="color:#22c55e;">Ø²Ø§Ø¦Ø±</span> ğŸ‘‹</h2></div>
      <div class="user-badge"><span id="walletHeader">0.00</span> $</div>
    </div>

    <div id="tab-home" class="page-section active animate__animated animate__fadeInUp">
      <h3 style="margin-bottom:15px; font-size:16px; color:#fff; display:flex; align-items:center; gap:8px;">
        <span style="font-size:20px;">ğŸš€</span> Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±
      </h3>
      <div id="plansContainer" class="plans-grid"></div>
      <div id="plansMsg" class="muted" style="text-align:center; margin-top:20px;"></div>
    </div>

    <div id="tab-invest" class="page-section animate__animated animate__fadeInUp">
      <h3 style="margin-bottom:15px; font-size:16px; color:#fff; display:flex; align-items:center; gap:8px;">
        <span style="font-size:20px;">ğŸ“Š</span> Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§ØªÙŠ Ø§Ù„Ù†Ø´Ø·Ø©
      </h3>
      <div id="myInvestments"></div>
      <div id="investMsg" class="muted" style="text-align:center; margin-top:10px;"></div>
    </div>

    <div id="tab-wallet" class="page-section animate__animated animate__fadeInUp">
      <div class="card wallet-box">
        <div class="muted">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ</div>
        <div class="wallet-amount animate__animated animate__pulse animate__infinite"><span id="walletAmount">0.00</span> $</div>
        <p class="muted" style="margin-top:10px; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px;">
          Ù„Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯: Ø§Ù†Ø³Ø® Ø§Ù„Ù€ ID Ù…Ù† ØµÙØ­Ø© Ø­Ø³Ø§Ø¨ÙŠ ÙˆØ£Ø±Ø³Ù„Ù‡ Ù„Ù„Ø£Ø¯Ù…Ù†.
        </p>
      </div>
      <div class="card">
        <h2>Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø±ØµÙŠØ¯</h2>
        <div class="field">
          <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ (Ø§Ù„Ù…Ø¨Ù„Øº + Ø§Ù„Ù…Ø­ÙØ¸Ø© TRC20)</label>
          <textarea id="depositMessage" rows="3" placeholder="Ø£Ø±ÙŠØ¯ Ø³Ø­Ø¨ 50$ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙØ¸Ø© Txxxx..."></textarea>
        </div>
        <button id="sendDepositMsgBtn" class="btn-danger">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ ğŸ“¤</button>
        <div id="depositMsgStatus" class="muted" style="margin-top:8px;"></div>
      </div>
    </div>

    <div id="tab-about" class="page-section animate__animated animate__fadeInUp">
      <div class="card" style="text-align:center;">
        <h1 style="color:#22c55e; font-size:24px; margin-bottom:8px;">Sky Miner â˜ï¸</h1>
        <p class="muted">Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø±Ø§Ø¦Ø¯Ø© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ† Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</p>
      </div>

      <div class="card">
        <h2 style="font-size:16px;">Ù„Ù…Ø§Ø°Ø§ ØªØ®ØªØ§Ø± Sky MinerØŸ</h2>
        <div class="about-feature">
          <div class="about-icon">ğŸ”’</div>
          <div>
            <div style="font-weight:bold; font-size:14px;">Ø£Ù…Ø§Ù† Ø¹Ø§Ù„ÙŠ</div>
            <div class="muted">Ù†Ø³ØªØ®Ø¯Ù… Ø£Ø­Ø¯Ø« ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„ØªØ´ÙÙŠØ± Ù„Ø­Ù…Ø§ÙŠØ© Ø£ØµÙˆÙ„Ùƒ.</div>
          </div>
        </div>
        <div class="about-feature">
          <div class="about-icon">âš¡</div>
          <div>
            <div style="font-weight:bold; font-size:14px;">Ø³Ø­Ø¨ ÙÙˆØ±ÙŠ</div>
            <div class="muted">Ù†Ø¸Ø§Ù… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø³Ø­ÙˆØ¨Ø§Øª Ø³Ø±ÙŠØ¹ ÙˆÙ…ÙˆØ«ÙˆÙ‚ 24/7.</div>
          </div>
        </div>
        <div class="about-feature">
          <div class="about-icon">ğŸ’°</div>
          <div>
            <div style="font-weight:bold; font-size:14px;">Ø¹ÙˆØ§Ø¦Ø¯ Ù…Ø¶Ù…ÙˆÙ†Ø©</div>
            <div class="muted">Ø®Ø·Ø· Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© Ù…Ø¯Ø±ÙˆØ³Ø© Ù„ØªØ­Ù‚ÙŠÙ‚ Ø£ÙØ¶Ù„ Ø±Ø¨Ø­ ÙŠÙˆÙ…ÙŠ.</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2 style="font-size:16px;">Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ©</h2>
        <p class="muted">
          Ù†Ø­Ù† ÙÙŠ Sky Miner Ù†Ø³Ø¹Ù‰ Ù„ØªÙˆÙÙŠØ± ÙØ±Øµ Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù„Ù„Ø¬Ù…ÙŠØ¹ØŒ Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø´Ø±Ø§Ø¡ Ø£Ø¬Ù‡Ø²Ø© Ø¨Ø§Ù‡Ø¸Ø© Ø§Ù„Ø«Ù…Ù†. Ù†Ø¸Ø§Ù…Ù†Ø§ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ ÙŠØªÙŠØ­ Ù„Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø±Ø£Ø³ Ù…Ø§Ù„ Ø¨Ø³ÙŠØ· ÙˆØ¬Ù†ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù…Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„.
        </p>
      </div>
    </div>

    <div id="tab-profile" class="page-section animate__animated animate__fadeInUp">
      <div class="card">
        <h2>Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
        <div class="field"><label>Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="profileName" readonly /></div>
        <div class="field"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input type="text" id="profileEmail" readonly style="direction:ltr; text-align:right;" /></div>
        <div class="field">
          <label style="color:#22c55e; font-weight:bold;">ğŸ†” Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ù„Ø´Ø­Ù†)</label>
          <div style="display:flex; gap:8px;">
            <input type="text" id="profileId" readonly value="..." />
            <button id="copyIdBtn" class="btn-secondary" style="width:90px;">Ù†Ø³Ø® ğŸ“‹</button>
          </div>
          <p class="muted" style="margin-top:4px;">Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ£Ø±Ø³Ù„Ù‡ Ù„Ù„Ø£Ø¯Ù…Ù†.</p>
        </div>
        <button id="logoutBtn" class="btn-danger" style="margin-top:15px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ğŸ”’</button>
      </div>
    </div>
  </div>

  <nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home', this)">
      <span class="nav-icon">ğŸ </span><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </div>
    <div class="nav-item" onclick="switchTab('invest', this)">
      <span class="nav-icon">ğŸ“ˆ</span><span>Ø§Ø³ØªØ«Ù…Ø§Ø±</span>
    </div>
    <div class="nav-item" onclick="switchTab('wallet', this)">
      <span class="nav-icon">ğŸ’°</span><span>Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
    </div>
    <div class="nav-item" onclick="switchTab('about', this)">
      <span class="nav-icon">â„¹ï¸</span><span>Ù…Ù† Ù†Ø­Ù†</span>
    </div>
    <div class="nav-item" onclick="switchTab('profile', this)">
      <span class="nav-icon">ğŸ‘¤</span><span>Ø­Ø³Ø§Ø¨ÙŠ</span>
    </div>
  </nav>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAPdLvL9yTmGaGRjcmFrTKcKSamL_Zso_s",
      authDomain: "sthmar-ff2e2.firebaseapp.com",
      projectId: "sthmar-ff2e2",
      storageBucket: "sthmar-ff2e2.firebasestorage.app",
      messagingSenderId: "456664476578",
      appId: "1:456664476578:web:3939cd5e00ba1b5a50e0fb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    window.switchTab = function(tabName, el) {
      document.querySelectorAll('.page-section').forEach(p => {
        p.classList.remove('active');
        p.classList.remove('animate__fadeInUp');
      });
      const target = document.getElementById('tab-' + tabName);
      target.classList.add('active');
      target.classList.add('animate__fadeInUp');
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      el.classList.add('active');
    };

    const authScreen = document.getElementById('authScreen');
    const showRegisterBtn = document.getElementById('showRegisterBtn');
    const backToLoginBtn = document.getElementById('backToLoginBtn');
    const loginBtn = document.getElementById('loginBtn');
    const doRegisterBtn = document.getElementById('doRegisterBtn');
    const nameFieldBox = document.getElementById('nameFieldBox');
    const authMsg = document.getElementById('authMsg');

    showRegisterBtn.onclick = () => {
      loginBtn.style.display = 'none'; showRegisterBtn.style.display = 'none';
      doRegisterBtn.style.display = 'flex'; backToLoginBtn.style.display = 'flex';
      nameFieldBox.style.display = 'block';
      authMsg.textContent = '';
    };
    backToLoginBtn.onclick = () => {
      loginBtn.style.display = 'flex'; showRegisterBtn.style.display = 'flex';
      doRegisterBtn.style.display = 'none'; backToLoginBtn.style.display = 'none';
      nameFieldBox.style.display = 'none';
      authMsg.textContent = '';
    };

    let currentUser = null;

    async function ensureUserDoc(user) {
      const userRef = doc(db, "users", user.uid);
      const snap = await getDoc(userRef);
      if (!snap.exists()) {
        await setDoc(userRef, {
          name: user.displayName || "Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯",
          email: user.email,
          walletBalance: 0,
          createdAt: serverTimestamp(),
          uid: user.uid
        });
      }
      return snap.exists() ? snap.data() : { walletBalance: 0 };
    }

    async function refreshUserData() {
      if (!currentUser) return;
      document.getElementById('profileName').value = currentUser.displayName;
      document.getElementById('profileEmail').value = currentUser.email;
      document.getElementById('profileId').value = currentUser.uid;

      const userRef = doc(db, "users", currentUser.uid);
      const snap = await getDoc(userRef);
      if (snap.exists()) {
        const bal = Number(snap.data().walletBalance || 0).toFixed(2);
        document.getElementById('walletAmount').textContent = bal;
        document.getElementById('walletHeader').textContent = bal;
      }
    }

    document.getElementById('copyIdBtn').onclick = () => {
      const idField = document.getElementById('profileId');
      idField.select();
      idField.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(idField.value).then(() => {
        const originalText = document.getElementById('copyIdBtn').textContent;
        document.getElementById('copyIdBtn').textContent = "ØªÙ… Ø§Ù„Ù†Ø³Ø®!";
        setTimeout(() => document.getElementById('copyIdBtn').textContent = originalText, 2000);
      });
    };

    function getMediaHtml(url) {
      if (!url) return `<img src="https://placehold.co/100" class="plan-media">`;
      if (url.includes('.mp4')) {
        return `<video src="${url}" class="plan-media" autoplay loop muted playsinline></video>`;
      }
      return `<img src="${url}" class="plan-media">`;
    }

    async function loadPlans() {
      const container = document.getElementById('plansContainer');
      container.innerHTML = '<div class="muted">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
      try {
        const q = query(collection(db, "plans"), where("active", "==", true), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);
        container.innerHTML = '';
        if (snap.empty) { container.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù‚Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>'; return; }
        
        snap.forEach(d => {
          const data = d.data();
          const div = document.createElement('div');
          div.className = 'plan-card animate__animated animate__zoomIn';
          const mediaContent = getMediaHtml(data.imageUrl);

          div.innerHTML = `
            ${mediaContent}
            <div class="plan-info">
              <div class="plan-title">${data.title}</div>
              <div class="plan-details">
                <span>ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${data.price}$</span>
                <span>ğŸ“ˆ Ø±Ø¨Ø­: ${data.dailyProfit}$</span>
              </div>
              <div class="plan-details" style="margin-top:6px;">
                <span>â³ Ø§Ù„Ù…Ø¯Ø©: ${data.durationDays} ÙŠÙˆÙ…</span>
              </div>
            </div>
            <button class="btn-main" onclick="buyPlan('${d.id}')" style="width:auto; padding:8px 16px; font-size:12px; box-shadow:none;">Ø´Ø±Ø§Ø¡</button>
          `;
          container.appendChild(div);
        });
      } catch (e) {
        document.getElementById('plansMsg').innerHTML = `<span style="color:orange">ØªÙ†Ø¨ÙŠÙ‡: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙÙ‡Ø±Ø³ (Index).</span>`;
      }
    }

    window.buyPlan = async (planId) => {
      if (!currentUser) return;
      if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø±Ø§Ø¡ØŸ")) return;
      try {
        const planSnap = await getDoc(doc(db, "plans", planId));
        if(!planSnap.exists()) return alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø©");
        const plan = planSnap.data();
        const userRef = doc(db, "users", currentUser.uid);
        const userSnap = await getDoc(userRef);
        const bal = userSnap.data().walletBalance || 0;
        
        if (bal < plan.price) return alert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§Ù!");
        await updateDoc(userRef, { walletBalance: bal - plan.price });
        await addDoc(collection(db, "user_plans"), {
          userId: currentUser.uid,
          planId: planId,
          title: plan.title,
          dailyProfit: Number(plan.dailyProfit),
          durationDays: Number(plan.durationDays),
          remainingDays: Number(plan.durationDays),
          active: true,
          startAt: serverTimestamp(),
          price: Number(plan.price)
        });
        alert("ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!");
        refreshUserData();
        loadMyInvestments();
      } catch(e) { console.log(e); alert("Ø­Ø¯Ø« Ø®Ø·Ø£"); }
    };

    async function loadMyInvestments() {
      const container = document.getElementById('myInvestments');
      if(!currentUser) return;
      try {
        const q = query(collection(db, "user_plans"), where("userId", "==", currentUser.uid), orderBy("startAt", "desc"));
        const snap = await getDocs(q);
        container.innerHTML = '';
        if(snap.empty) { container.innerHTML = '<div class="muted" style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª.</div>'; return; }
        
        snap.forEach(d => {
          const data = d.data();
          const isActive = data.active && data.remainingDays > 0;
          const div = document.createElement('div');
          div.className = 'invest-item animate__animated animate__fadeInLeft';
          div.innerHTML = `
            <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
              <strong>${data.title}</strong>
              <span style="font-size:11px; padding:2px 8px; background:${isActive?'#166534':'#334155'}; border-radius:10px;">${isActive?'Ù†Ø´Ø· ğŸŸ¢':'Ù…Ù†ØªÙ‡ÙŠ ğŸ”´'}</span>
            </div>
            <div class="muted">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${data.remainingDays} ÙŠÙˆÙ… | Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${data.dailyProfit}$</div>
            <button class="btn-secondary" onclick="collectProfit('${d.id}')" ${!isActive?'disabled':''} style="margin-top:10px; font-size:13px;">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ ğŸ’µ</button>
          `;
          container.appendChild(div);
        });
      } catch(e) { console.log(e); }
    }

    window.collectProfit = async (invId) => {
      try {
        const invRef = doc(db, "user_plans", invId);
        const invSnap = await getDoc(invRef);
        const inv = invSnap.data();
        const today = new Date().toISOString().slice(0,10);
        let lastRun = inv.lastRunDate ? inv.lastRunDate.toDate().toISOString().slice(0,10) : null;
        if(lastRun === today) return alert("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ… Ù…Ø³Ø¨Ù‚Ø§Ù‹.");
        
        const userRef = doc(db, "users", currentUser.uid);
        const userSnap = await getDoc(userRef);
        await updateDoc(userRef, { walletBalance: (userSnap.data().walletBalance||0) + inv.dailyProfit });
        await updateDoc(invRef, { remainingDays: inv.remainingDays - 1, lastRunDate: serverTimestamp(), active: (inv.remainingDays - 1 > 0) });
        alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­!");
        refreshUserData();
        loadMyInvestments();
      } catch(e) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£"); }
    };

    document.getElementById('sendDepositMsgBtn').onclick = async () => {
      const msg = document.getElementById('depositMessage').value;
      if(!msg) return alert("Ø§ÙƒØªØ¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„");
      await addDoc(collection(db, "deposit_requests"), {
        userId: currentUser.uid,
        userName: currentUser.displayName,
        message: msg,
        status: "new",
        createdAt: serverTimestamp()
      });
      alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©");
      document.getElementById('depositMessage').value = "";
    };

    loginBtn.onclick = async () => {
      try {
        await signInWithEmailAndPassword(auth, document.getElementById('authEmail').value, document.getElementById('authPassword').value);
      } catch(e) { authMsg.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + e.message; authMsg.style.color="#ef4444"; }
    };
    
    doRegisterBtn.onclick = async () => {
      try {
        const cred = await createUserWithEmailAndPassword(auth, document.getElementById('authEmail').value, document.getElementById('authPassword').value);
        await updateProfile(cred.user, { displayName: document.getElementById('authName').value });
        await ensureUserDoc(cred.user);
      } catch(e) { authMsg.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + e.message; authMsg.style.color="#ef4444"; }
    };

    document.getElementById('logoutBtn').onclick = () => signOut(auth);

    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      if (user) {
        authScreen.style.display = 'none';
        await ensureUserDoc(user);
        refreshUserData();
        loadPlans();
        loadMyInvestments();
      } else {
        authScreen.style.display = 'flex';
      }
    });
  </script>
</body>
</html>
