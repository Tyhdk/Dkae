
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <title>Crypto Cloud Manager - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ† Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</title>
  <meta name="description" content="Ù…Ù†ØµØ© Ù„Ù…Ø­Ø§ÙƒØ§Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ† Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ù„Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©.">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: 'Cairo', sans-serif;
      background: radial-gradient(circle at top, #0f172a, #000000);
      color: #f9fafb;
      height: 100vh;
      overflow: hidden;
      display: flex; flex-direction: column;
    }

    /* ØªÙ… Ø­Ø°Ù Ø´Ø±ÙŠØ· Ø§Ù„Ø§Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠ Ù„Ù…Ø®Ø§Ù„ÙØªÙ‡ Ø³ÙŠØ§Ø³Ø© "Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù…Ø®Ø§Ø¯Ø¹" */

    .app-content { flex: 1; overflow-y: auto; padding: 16px; padding-top: 20px; padding-bottom: 90px; scroll-behavior: smooth; }
    .page-section { display: none; }
    .page-section.active { display: block; animation: fadeInUp 0.5s ease-in-out; }

    /* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ */
    .bottom-nav {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      width: 95%; height: 65px;
      background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px;
      display: flex; justify-content: space-around; align-items: center;
      z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .nav-item {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      color: #64748b; font-size: 9px; cursor: pointer; width: 20%; height: 100%;
      transition: all 0.3s;
    }
    .nav-item.active { color: #f59e0b; transform: translateY(-5px); font-weight: bold; }
    .nav-icon { font-size: 20px; margin-bottom: 2px; }

    /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„ */
    .card {
      background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(10px);
      border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 16px; margin-bottom: 16px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
    }
    .muted { font-size: 12px; color: #94a3b8; line-height: 1.6; }
    
    .field { margin-bottom: 15px; position: relative; }
    .field label { font-size: 12px; margin-bottom: 6px; display: block; color: #cbd5e1; font-weight: bold; }
    .field input, .field textarea {
      width: 100%; padding: 12px; padding-right: 40px; border-radius: 12px;
      border: 2px solid #334155; background: #020617; color: #fff;
      font-size: 14px; text-align: right; transition: 0.3s;
    }
    .field input:focus { border-color: #f59e0b; box-shadow: 0 0 10px rgba(245, 158, 11, 0.2); }
    .field-icon { position: absolute; right: 12px; top: 38px; color: #64748b; font-size: 16px; }

    button {
      border: none; border-radius: 12px; padding: 12px; font-size: 15px;
      cursor: pointer; width: 100%; font-weight: 700;
      display: flex; align-items: center; justify-content: center; gap: 6px;
    }
    .btn-main { background: linear-gradient(to bottom, #f59e0b, #d97706); color: #fff; }
    .btn-secondary { background: #334155; color: #e2e8f0; }
    .btn-danger { background: linear-gradient(to right, #ef4444, #b91c1c); color: #fff; box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3); }
    .btn-google { background: #4285F4; color: #fff; }

    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± */
    .news-card { background: #0f172a; border-radius: 16px; overflow: hidden; margin-bottom: 24px; border: 1px solid #1e293b; }
    .news-media-container { width: 100%; height: 200px; background: #000; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .news-content { padding: 12px; }
    .news-title { color: #ef4444; font-weight: bold; font-size: 16px; margin-bottom: 6px; }
    .news-desc { color: #e2e8f0; font-size: 13px; margin-bottom: 10px; line-height: 1.5; }
    .news-stats { display: flex; gap: 15px; font-size: 12px; color: #94a3b8; border-top: 1px solid #1e293b; padding-top: 8px; }
    .stat-item { display: flex; align-items: center; gap: 4px; user-select: none; }
    .like-btn { cursor: pointer; }
    .like-btn.liked { color: #ef4444; font-weight: bold; animation: heartBeat 0.5s; }
    @keyframes heartBeat { 0%{transform:scale(1);} 50%{transform:scale(1.2);} 100%{transform:scale(1);} }
    .separator-line { height: 1px; background: linear-gradient(to right, transparent, #334155, transparent); margin: 20px 0; }

    /* Ø§Ù„Ø¨Ø§Ù‚Ø§Øª */
    .plan-card { display: flex; gap: 12px; align-items: center; background: rgba(15, 23, 42, 0.8); border: 1px solid #334155; padding: 12px; border-radius: 12px; margin-bottom: 10px; }
    .plan-media-thumb { width: 70px; height: 70px; border-radius: 8px; object-fit: cover; background: #000; }

    .invest-completed { opacity: 0.6; filter: grayscale(0.8); pointer-events: none; border-color: #334155 !important; }
    .invest-completed button { background: #1e293b !important; color: #94a3b8 !important; box-shadow: none !important; }

    /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    #loadingOverlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #000; z-index: 9999;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .loader { border: 4px solid #1e293b; border-top: 4px solid #f59e0b; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ† */
    .mining-modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); z-index: 3000;
      display: none; flex-direction: column; align-items: center; justify-content: center;
      padding: 20px;
    }
    .mining-content {
      background: #0f172a; padding: 30px; border-radius: 20px; width: 100%; max-width: 350px;
      text-align: center; border: 1px solid #334155; position: relative;
    }
    .mining-icon { font-size: 50px; margin-bottom: 20px; animation: bounce 1s infinite; display: inline-block; }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    .progress-container { width: 100%; height: 10px; background: #334155; border-radius: 10px; overflow: hidden; margin: 15px 0; }
    .progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #f59e0b, #ef4444); transition: width 0.1s linear; }

    .history-item { padding: 12px; border-bottom: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
    .history-status { padding: 3px 8px; border-radius: 10px; font-size: 11px; font-weight: bold; }
    .st-pending { background: rgba(249, 115, 22, 0.2); color: #fb923c; } 
    .st-approved { background: rgba(34, 197, 94, 0.2); color: #4ade80; } 
    .st-rejected { background: rgba(239, 68, 68, 0.2); color: #f87171; }

    .custom-alert-modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); z-index: 4000;
      display: none; align-items: center; justify-content: center;
    }
    .custom-alert-box {
      background: #0f172a; border: 1px solid;
      padding: 25px; border-radius: 20px; text-align: center; color: #fff; 
      max-width: 85%; width: 320px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    .alert-success { border-color: #10b981; }
    .alert-error { border-color: #ef4444; }

    /* Disclaimer Modal */
    #disclaimerModal {
        position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:99999;
        display:none; align-items:center; justify-content:center; padding:20px;
    }

    #authScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; padding: 25px; display: flex; flex-direction: column; justify-content: center; }
    
    .team-stat-box {
        background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; text-align: center; flex: 1;
        border: 1px solid rgba(255,255,255,0.05);
    }
    .level-card {
        background: #1e293b; padding: 10px; border-radius: 8px; margin-bottom: 8px; font-size: 12px;
        border-right: 3px solid #f59e0b;
    }
    .level-locked { opacity: 0.5; border-right-color: #64748b; }
  </style>
</head>
<body>

  <div id="disclaimerModal">
      <div class="card" style="max-width:350px; text-align:center; border:1px solid #f59e0b;">
          <h3 style="color:#f59e0b; margin-bottom:10px;">âš ï¸ ØªÙ†ÙˆÙŠÙ‡ Ù‡Ø§Ù…</h3>
          <p class="muted" style="font-size:13px; text-align:right; margin-bottom:15px;">
              Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‡Ùˆ Ø£Ø¯Ø§Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© <b>Ø§Ù„ØªØ¹Ø¯ÙŠÙ† Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ (Cloud Mining)</b> ÙÙ‚Ø·.<br><br>
              Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ <b>Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù…</b> Ù…ÙˆØ§Ø±Ø¯ Ø¬Ù‡Ø§Ø²Ùƒ (CPU/GPU) ÙˆÙ„Ø§ ÙŠØ³ØªÙ‡Ù„Ùƒ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ†.<br><br>
              Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ØªØªÙ… Ø¹Ù„Ù‰ Ø®ÙˆØ§Ø¯Ù… Ø³Ø­Ø§Ø¨ÙŠØ©.
          </p>
          <button onclick="closeDisclaimer()" class="btn-main">ÙÙ‡Ù…Øª Ø°Ù„Ùƒ âœ…</button>
      </div>
  </div>

  <div id="loadingOverlay">
    <div class="loader"></div>
    <div class="muted" style="margin-top:15px; color:#f59e0b;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...</div>
  </div>

  <div id="miningModal" class="mining-modal">
    <div class="mining-content animate__animated animate__zoomIn">
      <div class="mining-icon">â›ï¸</div>
      <div style="font-size:16px; font-weight:bold;">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ù‚Ø¯...</div>
      <div class="progress-container"><div id="miningProgressBar" class="progress-bar"></div></div>
      <div id="miningPercentText" style="color:#f59e0b;">0%</div>
    </div>
  </div>

  <div id="withdrawHistoryModal" class="mining-modal" style="display:none;">
    <div class="mining-content animate__animated animate__fadeInUp" style="text-align:right;">
      <h3 style="color:#fff; margin-bottom:15px; border-bottom:1px solid #334155; padding-bottom:10px;">ğŸ•’ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
      <div id="historyListContainer" style="max-height:300px; overflow-y:auto;"></div>
      <button class="btn-secondary" onclick="closeHistoryModal()" style="margin-top:15px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <div id="customAlertModal" class="custom-alert-modal">
    <div id="customAlertBox" class="custom-alert-box animate__animated animate__bounceIn">
      <div id="customAlertIcon" style="font-size:45px; margin-bottom:10px;">âš ï¸</div>
      <h3 id="customAlertTitle" style="margin-bottom:8px;">ØªÙ†Ø¨ÙŠÙ‡</h3>
      <p id="customAlertMsg" style="font-size:14px; line-height:1.6; color:#cbd5e1;"></p>
      <button id="customAlertBtn" class="btn-main" style="margin-top:15px;">Ø­Ø³Ù†Ø§Ù‹</button>
    </div>
  </div>

  <div id="authScreen" class="animate__animated animate__fadeIn" style="display:none;">
    <div style="text-align:center; margin-bottom:30px;">
      <h1 class="animate__animated animate__bounceInDown" style="color:#f59e0b; font-size: 28px;">Cloud Manager</h1>
      <p class="muted">Ø¥Ø¯Ø§Ø±Ø© Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§ØªÙƒ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©</p>
    </div>
    <div class="field animate__animated animate__fadeInUp"><label>Email</label><input type="email" id="authEmail" style="direction:ltr;"></div>
    <div class="field animate__animated animate__fadeInUp"><label>Password</label><input type="password" id="authPassword" style="direction:ltr;"></div>
    <div class="field animate__animated animate__fadeInUp" id="nameFieldBox" style="display:none;"><label>Name</label><input type="text" id="authName"></div>
    <div class="animate__animated animate__fadeInUp">
      <button id="loginBtn" class="btn-main" style="margin-bottom:10px;">Ø¯Ø®ÙˆÙ„</button>
      <button id="showRegisterBtn" class="btn-secondary" style="margin-bottom:10px;">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
      <button id="doRegisterBtn" class="btn-main" style="display:none; margin-bottom:10px;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
      <button id="backToLoginBtn" class="btn-secondary" style="display:none; margin-bottom:10px;">Ø¹ÙˆØ¯Ø©</button>
      
      <button id="googleAuthBtn" class="btn-google" style="margin-bottom:10px;"><img src="https://img.icons8.com/color/18/ffffff/google-logo.png" style="margin-left:8px;"> Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google</button>
      
      <button id="guestLoginBtn" class="btn-secondary" style="background:transparent; border:1px solid #334155; color:#94a3b8;">ØªØµÙØ­ ÙƒØ²Ø§Ø¦Ø± ğŸ•µï¸</button>
      
      <a href="https://doc-hosting.flycricket.io/dr-lt-dyn-lshby-privacy-policy/12a13324-08bb-4ea3-b6b5-53dc274c3973/privacy" target="_blank" style="display:block; text-align:center; color:#64748b; font-size:11px; margin-top:15px; text-decoration:none;">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a>
    </div>
    <p id="authMsg" style="text-align:center; margin-top:15px; font-size:12px; color:#ef4444;"></p>
  </div>

  <div class="app-content">
    <div class="header-top">
      <div><h2 style="font-size:16px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="userNameTag" style="color:#f59e0b;">...</span></h2></div>
      <div class="user-badge"><span id="walletHeader">0.00</span> USDT</div>
    </div>

    <div id="tab-news" class="page-section active animate__animated animate__fadeIn">
      <div id="newsContainer"></div>
      <div id="newsMsg" class="muted" style="text-align:center;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±...</div>
    </div>

    <div id="tab-plans" class="page-section animate__animated animate__fadeIn">
      <h3 style="margin-bottom:10px; font-size:15px;">ğŸš€ Ø¹Ù‚ÙˆØ¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ† Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</h3>
      <div id="plansContainer"></div>
    </div>

    <div id="tab-invest" class="page-section animate__animated animate__fadeIn">
      <h3 style="margin-bottom:10px; font-size:15px;">ğŸ“Š Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©</h3>
      <div id="myInvestments"></div>
    </div>

    <div id="tab-wallet" class="page-section animate__animated animate__fadeIn">
      <div class="card" style="text-align:center; padding: 25px;">
        <div class="muted">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</div>
        <div style="font-size:36px; color:#4ade80; font-weight:bold; margin:10px 0;"><span id="walletAmount">0.00</span> USDT</div>
      </div>
      
      <button onclick="window.open('https://t.me/am_an12', '_blank')" class="btn-main" style="background: linear-gradient(to right, #229ED9, #0088cc); margin-bottom: 16px;">
          ğŸ“¥ Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯ (ØªÙˆØ§ØµÙ„ ØªÙ„Ø¬Ø±Ø§Ù…)
      </button>

      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
           <h3 style="margin:0;">Ø·Ù„Ø¨ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
           <div onclick="openHistoryModal()" style="font-size:12px; color:#f59e0b; cursor:pointer; display:flex; align-items:center; gap:4px;">
             <span>ğŸ“œ</span> Ø§Ù„Ø³Ø¬Ù„
           </div>
        </div>

        <div class="field">
          <label>Ø§Ù„Ù…Ø¨Ù„Øº (USDT)</label>
          <span class="field-icon">ğŸ’²</span>
          <input type="number" id="withdrawAmount" placeholder="Ù…Ø«Ø§Ù„: 50">
        </div>
        
        <p class="muted" style="margin-bottom:15px; font-size:11px; text-align:center;">
          ØªØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©.
        </p>

        <button id="sendDepositMsgBtn" class="btn-danger">ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
        <div id="depositMsgStatus" class="muted" style="margin-top:10px; text-align:center;"></div>
      </div>
    </div>

    <div id="tab-profile" class="page-section animate__animated animate__fadeIn">
      <div class="card">
         <div id="guestProfileMsg" style="display:none; text-align:center; padding:20px;">
             <div style="font-size:40px; margin-bottom:10px;">ğŸ”’</div>
             <p style="color:#ef4444; font-weight:bold;">Ø£Ù†Øª ØªØªØµÙØ­ ÙƒØ²Ø§Ø¦Ø±</p>
             <p class="muted">ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.</p>
             <button onclick="location.reload()" class="btn-main" style="margin-top:15px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
         </div>

         <div id="userProfileContent">
            <div style="background:#0f172a; padding:15px; border-radius:12px; border:1px solid #f59e0b; margin-bottom:15px;">
                <label style="color:#f59e0b; font-weight:bold; display:block; margin-bottom:8px;">ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©</label>
                <div style="display:flex; gap:5px;">
                   <input type="text" id="referralLink" readonly style="font-size:11px; color:#94a3b8; background:#000;" value="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...">
                   <button onclick="copyReferral()" class="btn-main" style="width:50px; font-size:18px;">ğŸ“‹</button>
                </div>
            </div>

            <h3 style="font-size:14px; margin-bottom:10px;">ğŸ‘¥ Ø§Ù„ÙØ±ÙŠÙ‚</h3>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <div class="team-stat-box">
                    <div style="font-size:20px; color:#fff; font-weight:bold;" id="teamCount">0</div>
                    <div class="muted">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div>
                </div>
                <div class="team-stat-box">
                    <div style="font-size:20px; color:#4ade80; font-weight:bold;"><span id="teamEarnings">0.00</span></div>
                    <div class="muted">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</div>
                </div>
            </div>

            <div class="level-card" id="lvl1Box">
                <div style="font-weight:bold; color:#f59e0b;">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</div>
                <div class="muted">Ù‚Ù… Ø¨Ø¯Ø¹ÙˆØ© Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ¢Øª ØªØ´Ø¬ÙŠØ¹ÙŠØ©.</div>
            </div>
            
            <hr style="border:0; border-top:1px solid #334155; margin:15px 0;">

            <div class="field">
            <label style="color:#f59e0b;">ğŸ†” Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
            <div style="position:relative;">
                <input type="text" id="profileId" readonly onclick="copyId()" style="cursor:copy; text-align:center; letter-spacing:1px; background:#0f172a; border-color:#f59e0b;">
                <span style="position:absolute; left:10px; top:12px; font-size:18px;">ğŸ“‹</span>
            </div>
            </div>

            <div class="field"><label>Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="profileName" readonly></div>
            <div class="field"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input type="text" id="profileEmail" readonly style="direction:ltr;"></div>
            
            <div class="field">
            <label>Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (USDT TRC20)</label>
            <div style="display:flex; gap:8px;">
                <input type="text" id="profileWallet" placeholder="Txxxxxxxxxxxxxxxxxxxxxx" style="direction:ltr; font-family:monospace;">
                <button id="saveWalletBtn" class="btn-main" style="width:70px; font-size:12px; display:none;">Ø­ÙØ¸</button>
            </div>
            </div>

            <button onclick="window.open('https://t.me/YOUR_SUPPORT_CHANNEL', '_blank')" class="btn-secondary" style="margin-top:15px; background:#229ED9;">
                ğŸ’¬ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ
            </button>
            
            <button onclick="window.open('https://doc-hosting.flycricket.io/dr-lt-dyn-lshby-privacy-policy/12a13324-08bb-4ea3-b6b5-53dc274c3973/privacy', '_blank')" class="btn-secondary" style="margin-top:10px;">
                ğŸ”’ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©
            </button>

            <button id="logoutBtn" class="btn-danger" style="margin-top:15px;">Ø®Ø±ÙˆØ¬ ğŸ”’</button>
        </div>
      </div>
    </div>
  </div>

  <nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('news', this)"><span class="nav-icon">ğŸ“°</span><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></div>
    <div class="nav-item" onclick="switchTab('plans', this)"><span class="nav-icon">ğŸ’</span><span>Ø§Ù„Ø¹Ù‚ÙˆØ¯</span></div>
    <div class="nav-item" onclick="switchTab('invest', this)"><span class="nav-icon">ğŸ“ˆ</span><span>Ù†Ø´Ø§Ø·ÙŠ</span></div>
    <div class="nav-item" onclick="switchTab('wallet', this)"><span class="nav-icon">ğŸ’°</span><span>Ø§Ù„Ù…Ø­ÙØ¸Ø©</span></div>
    <div class="nav-item" onclick="switchTab('profile', this)"><span class="nav-icon">ğŸ‘¤</span><span>Ø­Ø³Ø§Ø¨ÙŠ</span></div>
  </nav>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, updateProfile, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAPdLvL9yTmGaGRjcmFrTKcKSamL_Zso_s",
      authDomain: "sthmar-ff2e2.firebaseapp.com",
      projectId: "sthmar-ff2e2",
      storageBucket: "sthmar-ff2e2.firebasestorage.app",
      messagingSenderId: "456664476578",
      appId: "1:456664476578:web:3939cd5e00ba1b5a50e0fb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const googleProvider = new GoogleAuthProvider();
    let currentUser = null;
    let isGuest = false;

    // --- Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†ÙˆÙŠÙ‡ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ---
    window.closeDisclaimer = () => {
        document.getElementById('disclaimerModal').style.display = 'none';
        localStorage.setItem('disclaimerSeen', 'true');
    };

    const urlParams = new URLSearchParams(window.location.search);
    const refCode = urlParams.get('ref');
    if (refCode) {
        localStorage.setItem('referredBy', refCode);
    }

    window.showCustomAlert = (title, message, isError = false, redirectTab = null) => {
      const modal = document.getElementById('customAlertModal');
      const box = document.getElementById('customAlertBox');
      const icon = document.getElementById('customAlertIcon');
      const titleEl = document.getElementById('customAlertTitle');
      const msgEl = document.getElementById('customAlertMsg');
      const btn = document.getElementById('customAlertBtn');

      modal.style.display = 'flex';
      titleEl.innerText = title;
      msgEl.innerText = message;
      
      if (isError) {
        box.classList.add('alert-error'); box.classList.remove('alert-success');
        icon.innerText = 'âŒ'; titleEl.style.color = '#ef4444';
      } else {
        box.classList.add('alert-success'); box.classList.remove('alert-error');
        icon.innerText = 'âœ…'; titleEl.style.color = '#10b981';
      }

      btn.onclick = () => {
        modal.style.display = 'none';
        if (redirectTab) {
           const tabBtn = document.querySelector(`.nav-item[onclick*="${redirectTab}"]`);
           if(tabBtn) switchTab(redirectTab, tabBtn);
        }
      };
    };

    window.copyId = () => {
      const idField = document.getElementById('profileId');
      idField.select(); idField.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(idField.value).then(() => { showCustomAlert("Ù†Ø³Ø®","ØªÙ… Ø§Ù„Ù†Ø³Ø®", false); });
    };

    window.copyReferral = () => {
        const link = document.getElementById('referralLink');
        link.select(); link.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(link.value).then(() => { showCustomAlert("Ù†Ø³Ø®","ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·", false); });
    };

    document.getElementById('saveWalletBtn').onclick = async () => {
      const w = document.getElementById('profileWallet').value.trim();
      if (!w) return showCustomAlert("Ø®Ø·Ø£","Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", true);
      if (!confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­ÙØ¸ØŸ")) return;
      try {
        await updateDoc(doc(db, "users", currentUser.uid), { walletAddress: w });
        showCustomAlert("Ù†Ø¬Ø§Ø­","ØªÙ… Ø§Ù„Ø­ÙØ¸", false);
        refreshUserData(); 
      } catch (e) { showCustomAlert("Ø®Ø·Ø£","Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸", true); }
    };

    function processMediaUrl(url) {
      if (!url) return { type: 'image', src: 'https://placehold.co/600x400/000/FFF?text=No+Media' };
      if (url.includes('drive.google.com') || url.includes('docs.google.com')) {
        let fileId = null; const match = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
        if (match && match[1]) fileId = match[1]; else { const u = new URL(url); fileId = u.searchParams.get("id"); }
        if (fileId) return { type: 'iframe', src: `https://drive.google.com/file/d/${fileId}/preview` };
      }
      if (url.match(/\.(mp4|webm|ogg)$/i)) return { type: 'video', src: url };
      return { type: 'image', src: url };
    }
    function generateMediaHTML(url, h="200px") {
      const m = processMediaUrl(url);
      if (m.type==='iframe') return `<iframe src="${m.src}" style="width:100%;height:${h};border:none;"></iframe>`;
      else if(m.type==='video') return `<video src="${m.src}" style="width:100%;height:${h};object-fit:cover;" controls playsinline></video>`;
      return `<img src="${m.src}" style="width:100%;height:${h};object-fit:cover;">`;
    }

    window.switchTab = function(tabName, el) {
      if (isGuest && (tabName === 'profile' || tabName === 'invest' || tabName === 'wallet')) {
          if(tabName === 'profile') {
          } else {
             showCustomAlert("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.", true);
             return; 
          }
      }
      
      document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      el.classList.add('active');

      if(tabName === 'news') loadNews();
      if(tabName === 'plans') loadPlans();
      if(tabName === 'invest' && !isGuest) loadMyInvestments();
      
      if (tabName === 'profile') {
          if (isGuest) {
              document.getElementById('userProfileContent').style.display = 'none';
              document.getElementById('guestProfileMsg').style.display = 'block';
          } else {
              document.getElementById('userProfileContent').style.display = 'block';
              document.getElementById('guestProfileMsg').style.display = 'none';
          }
      }
    };

    window.openHistoryModal = async () => {
      document.getElementById('withdrawHistoryModal').style.display = 'flex';
      const list = document.getElementById('historyListContainer');
      list.innerHTML = '<div class="muted">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
      try {
        const q = query(collection(db, "deposit_requests"), where("userId", "==", currentUser.uid), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);
        if (snap.empty) { list.innerHTML = '<div class="muted">Ø§Ù„Ø³Ø¬Ù„ ÙØ§Ø±Øº.</div>'; return; }
        list.innerHTML = '';
        snap.forEach(d => {
          const data = d.data();
          let statusClass = 'st-pending'; let statusText = 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
          if (data.status === 'approved') { statusClass = 'st-approved'; statusText = 'Ù…ÙƒØªÙ…Ù„'; }
          else if (data.status === 'rejected') { statusClass = 'st-rejected'; statusText = 'Ù…Ø±ÙÙˆØ¶'; }
          const date = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString('ar-EG') : '-';
          const div = document.createElement('div');
          div.className = 'history-item';
          div.innerHTML = `<div><div style="font-weight:bold; color:#fff;">${data.amount || 0} USDT</div><div class="muted">${date}</div></div><div class="history-status ${statusClass}">${statusText}</div>`;
          list.appendChild(div);
        });
      } catch (e) { list.innerHTML = '<div class="muted" style="color:red">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„.</div>'; }
    };
    window.closeHistoryModal = () => { document.getElementById('withdrawHistoryModal').style.display = 'none'; };

    document.getElementById('sendDepositMsgBtn').onclick = async () => {
      if(isGuest) return showCustomAlert("ØªÙ†Ø¨ÙŠÙ‡", "Ø£Ù†Øª ØºÙŠØ± Ù…Ø³Ø¬Ù„", true);
      const amountInput = document.getElementById('withdrawAmount').value;
      const statusDiv = document.getElementById('depositMsgStatus');

      if(!amountInput) { showCustomAlert("Ø®Ø·Ø£", "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº", true); return; }
      const amount = Number(amountInput);
      if (amount <= 0) { showCustomAlert("Ø®Ø·Ø£", "Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ­ÙŠØ­", true); return; }

      statusDiv.textContent = "Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";

      try {
        const userRef = doc(db, "users", currentUser.uid);
        const userSnap = await getDoc(userRef);
        const userData = userSnap.data();
        const currentBalance = userData.walletBalance || 0;
        const savedWallet = userData.walletAddress;

        if (!savedWallet) {
          statusDiv.textContent = "";
          showCustomAlert("ØªÙ†Ø¨ÙŠÙ‡", "Ø£Ø¶Ù Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙÙŠ ØµÙØ­Ø© Ø­Ø³Ø§Ø¨ÙŠ Ø£ÙˆÙ„Ø§Ù‹.", true, "profile");
          return;
        }

        if (amount > currentBalance) {
          statusDiv.textContent = "";
          showCustomAlert("ØªÙ†Ø¨ÙŠÙ‡", `Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ.`, true);
          return; 
        }

        const qCheck = query(collection(db, "deposit_requests"), where("userId", "==", currentUser.uid), where("status", "==", "new"));
        const snapCheck = await getDocs(qCheck);
        if (!snapCheck.empty) {
          statusDiv.textContent = "";
          showCustomAlert("ØªÙ†Ø¨ÙŠÙ‡", "Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.", true);
          return;
        }

        await addDoc(collection(db, "deposit_requests"), {
          userId: currentUser.uid, userName: currentUser.displayName,
          message: "Ø·Ù„Ø¨ Ø³Ø­Ø¨", amount: amount, walletAddress: savedWallet,
          status: "new", createdAt: serverTimestamp()
        });

        statusDiv.textContent = "";
        showCustomAlert("ØªÙ…", "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­", false);
        document.getElementById('withdrawAmount').value = "";
      } catch (error) { statusDiv.textContent = "Ø®Ø·Ø£"; showCustomAlert("Ø®Ø·Ø£", "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„", true); }
    };

    async function loadMyInvestments() {
      const container = document.getElementById('myInvestments');
      if(!currentUser || isGuest) return;
      try {
        const q = query(collection(db, "user_plans"), where("userId", "==", currentUser.uid), orderBy("startAt", "desc"));
        const snap = await getDocs(q);
        container.innerHTML = '';
        if(snap.empty) { container.innerHTML = '<div class="muted" style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù‚ÙˆØ¯ Ù†Ø´Ø·Ø©.</div>'; return; }
        
        const today = new Date().toISOString().slice(0,10);
        snap.forEach(d => {
          const data = d.data();
          const isActive = data.active && data.remainingDays > 0;
          let lastRun = data.lastRunDate ? data.lastRunDate.toDate().toISOString().slice(0,10) : null;
          const isDoneToday = (lastRun === today);
          const isCompletedCard = !isActive || isDoneToday;
          const cardClass = isCompletedCard ? "card invest-completed animate__animated animate__fadeInLeft" : "card animate__animated animate__fadeInLeft";
          
          let btnText = "âš¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù‚Ø¯ (Check Node)";
          if (!isActive) btnText = "Ù…Ù†ØªÙ‡ÙŠ";
          else if (isDoneToday) btnText = "âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙŠÙˆÙ…";

          const miningDuration = data.miningTime || 3000;
          const div = document.createElement('div');
          div.className = cardClass;
          div.innerHTML = `
            <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
              <strong>${data.title}</strong>
              <span style="font-size:11px; padding:2px 8px; background:${isActive?'#166534':'#334155'}; border-radius:10px;">${isActive?'Ù†Ø´Ø·':'Ù…Ù†ØªÙ‡ÙŠ'}</span>
            </div>
            <div class="muted">Ø§Ù„Ù…Ø¯Ø©: ${data.remainingDays} ÙŠÙˆÙ… | Ø§Ù„Ø¹Ø§Ø¦Ø¯: ${data.dailyProfit} USDT</div>
            <button class="btn-secondary" onclick="startMiningAnimation('${d.id}', ${data.dailyProfit}, ${miningDuration})" ${isCompletedCard ? 'disabled' : ''} style="margin-top:10px; font-size:13px;">${btnText}</button>
          `;
          container.appendChild(div);
        });
      } catch(e) { console.log(e); }
    }

    window.startMiningAnimation = async (invId, dailyProfit, duration) => {
      const modal = document.getElementById('miningModal');
      const progressBar = document.getElementById('miningProgressBar');
      const percentText = document.getElementById('miningPercentText');
      modal.style.display = 'flex';
      let start = 0; const step = 100 / (duration / 100); 
      const timer = setInterval(() => {
        start += step;
        if (start >= 100) {
          start = 100; clearInterval(timer);
          collectProfit(invId);
          setTimeout(() => { modal.style.display = 'none'; progressBar.style.width = '0%'; percentText.innerText = '0%'; }, 1000);
        }
        progressBar.style.width = start + '%'; percentText.innerText = Math.floor(start) + '%';
      }, 100);
    };

    async function collectProfit(invId) {
      try {
        const invRef = doc(db, "user_plans", invId);
        const invSnap = await getDoc(invRef);
        const inv = invSnap.data();
        const today = new Date().toISOString().slice(0,10);
        let lastRun = inv.lastRunDate ? inv.lastRunDate.toDate().toISOString().slice(0,10) : null;
        if(lastRun === today) { showCustomAlert("ØªÙ†Ø¨ÙŠÙ‡", "ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹", true); loadMyInvestments(); return; }

        const userRef = doc(db, "users", currentUser.uid);
        const userSnap = await getDoc(userRef);
        await updateDoc(userRef, { walletBalance: (userSnap.data().walletBalance||0) + inv.dailyProfit });
        await updateDoc(invRef, { remainingDays: inv.remainingDays - 1, lastRunDate: serverTimestamp(), active: (inv.remainingDays - 1 > 0) });
        showCustomAlert("Ù†Ø¬Ø§Ø­", `ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!`, false);
        refreshUserData(); loadMyInvestments();
      } catch(e) { showCustomAlert("Ø®Ø·Ø£", "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„", true); }
    }

    window.handleLike = async (newsId, btnEl) => {
      const k = `liked_${newsId}`; if (localStorage.getItem(k)) return;
      btnEl.querySelector('span').innerText = parseInt(btnEl.querySelector('span').innerText) + 1;
      btnEl.classList.add('liked'); localStorage.setItem(k, "true");
      try { await updateDoc(doc(db, "news", newsId), { startLikes: increment(1) }); } catch (e) {}
    };

    async function loadNews() {
      const c = document.getElementById('newsContainer'); const m = document.getElementById('newsMsg');
      try {
        const q = query(collection(db, "news"), orderBy("createdAt", "desc"));
        const s = await getDocs(q); if (s.empty) { c.innerHTML=''; m.innerText="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø¨Ø§Ø±"; return; }
        m.style.display='none'; c.innerHTML='';
        s.forEach(d => {
          const dt = d.data(); const lk = localStorage.getItem(`liked_${d.id}`) ? 'liked' : '';
          const div = document.createElement('div'); div.className='news-card animate__animated animate__fadeInUp';
          div.innerHTML = `<div class="news-media-container">${generateMediaHTML(dt.mediaUrl,"220px")}</div>
            <div class="news-content"><div class="news-title">${dt.title}</div><div class="news-desc">${dt.description}</div>
            <div class="news-stats"><div class="stat-item">ğŸ‘ï¸â€ğŸ—¨ï¸ ${dt.startViews}</div><div class="stat-item like-btn ${lk}" onclick="handleLike('${d.id}',this)">â¤ï¸ <span>${dt.startLikes}</span></div></div></div><div class="separator-line"></div>`;
          c.appendChild(div);
        });
      } catch(e){ m.innerText="Ø®Ø·Ø£"; }
    }

    async function loadPlans() {
      const c = document.getElementById('plansContainer'); c.innerHTML='<div class="muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
      try {
        const q = query(collection(db, "plans"), where("active", "==", true), orderBy("createdAt", "desc"));
        const s = await getDocs(q); if(s.empty){ c.innerHTML='Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù‚ÙˆØ¯ Ù…ØªØ§Ø­Ø©'; return; }
        c.innerHTML='';
        s.forEach(d => {
          const dt = d.data(); const div = document.createElement('div'); div.className='plan-card';
          let th = ''; const mo = processMediaUrl(dt.imageUrl);
          if(mo.type==='iframe') th=`<iframe src="${mo.src}" class="plan-media-thumb" style="border:none;pointer-events:none;"></iframe>`;
          else if(mo.type==='video') th=`<video src="${mo.src}" class="plan-media-thumb"></video>`;
          else th=`<img src="${mo.src}" class="plan-media-thumb">`;
          div.innerHTML = `<div style="min-width:70px;">${th}</div><div style="flex:1;"><div style="font-weight:bold;color:#f59e0b;">${dt.title}</div><div class="muted">Ø³Ø¹Ø± Ø§Ù„Ø¹Ù‚Ø¯: ${dt.price} USDT</div><div class="muted">Ø§Ù„Ù…Ø¯Ø©: ${dt.durationDays} ÙŠÙˆÙ…</div></div><button class="btn-main" onclick="buyPlan('${d.id}')" style="width:auto;padding:5px 15px;font-size:12px;">Ø§Ø´ØªØ±Ø§Ùƒ</button>`;
          c.appendChild(div);
        });
      } catch(e){ c.innerHTML="Ø®Ø·Ø£"; }
    }

    window.buyPlan = async (id) => {
        if(isGuest) return showCustomAlert("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„", true);
        if(!currentUser) return;
        if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¹Ù‚Ø¯ØŸ")) return;
        try {
          const ps = await getDoc(doc(db, "plans", id)); const p = ps.data();
          const ur = doc(db, "users", currentUser.uid); const us = await getDoc(ur);
          const userData = us.data();

          if((userData.walletBalance||0) < p.price) return showCustomAlert("Ø®Ø·Ø£", "Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§Ù!", true);
          
          await updateDoc(ur, { walletBalance: (userData.walletBalance) - p.price });
          
          await addDoc(collection(db, "user_plans"), {
            userId: currentUser.uid, planId: id, title: p.title, dailyProfit: Number(p.dailyProfit),
            durationDays: Number(p.durationDays), remainingDays: Number(p.durationDays), active: true,
            startAt: serverTimestamp(), price: Number(p.price), miningTime: p.miningTime || 5000,
            lastRunDate: null 
          });

          if (userData.referredBy) {
              await calculateAndDistributeCommission(userData.referredBy, p.price);
          }

          showCustomAlert("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­", false);
          refreshUserData(); loadMyInvestments();
        } catch(e){ console.log(e); showCustomAlert("Ø®Ø·Ø£", "Ø­Ø¯Ø« Ø®Ø·Ø£ Ù…Ø§", true); }
    };

    async function calculateAndDistributeCommission(uplineId, amountSpent) {
        try {
            const uplineRef = doc(db, "users", uplineId);
            const uplineSnap = await getDoc(uplineRef);
            if (!uplineSnap.exists()) return;
            
            const teamQuery = query(collection(db, "users"), where("referredBy", "==", uplineId));
            const teamSnap = await getDocs(teamQuery);
            const teamCount = teamSnap.size;

            let percentage = 0;
            if (teamCount >= 10) percentage = 0.03; 
            else if (teamCount >= 5) percentage = 0.02; 
            else if (teamCount >= 2) percentage = 0.01; 
            
            if(percentage > 0) {
                 const commission = amountSpent * percentage;
                 await updateDoc(uplineRef, {
                     walletBalance: increment(commission),
                     teamTotalEarnings: increment(commission)
                 });
            }
        } catch (error) { console.log(error); }
    }

    const loadingOverlay = document.getElementById('loadingOverlay');
    const authScreen = document.getElementById('authScreen');
    const showRegisterBtn = document.getElementById('showRegisterBtn');
    const backToLoginBtn = document.getElementById('backToLoginBtn');
    const loginBtn = document.getElementById('loginBtn');
    const doRegisterBtn = document.getElementById('doRegisterBtn');
    const nameFieldBox = document.getElementById('nameFieldBox');
    const authMsg = document.getElementById('authMsg');
    const guestBtn = document.getElementById('guestLoginBtn');
    const googleAuthBtn = document.getElementById('googleAuthBtn');

    showRegisterBtn.onclick = () => { 
        loginBtn.style.display='none'; showRegisterBtn.style.display='none'; doRegisterBtn.style.display='block'; backToLoginBtn.style.display='block'; nameFieldBox.style.display='block'; authMsg.textContent=''; guestBtn.style.display='none'; googleAuthBtn.style.display='none';
    };
    backToLoginBtn.onclick = () => { 
        loginBtn.style.display='block'; showRegisterBtn.style.display='block'; doRegisterBtn.style.display='none'; backToLoginBtn.style.display='none'; nameFieldBox.style.display='none'; authMsg.textContent=''; guestBtn.style.display='block'; googleAuthBtn.style.display='block';
    };

    guestBtn.onclick = () => {
        isGuest = true;
        currentUser = null;
        authScreen.style.display = 'none';
        loadingOverlay.style.display = 'none';
        document.getElementById('userNameTag').innerText = "Ø²Ø§Ø¦Ø±";
        loadNews();
        loadPlans();
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„ØªÙ†ÙˆÙŠÙ‡
        if (!localStorage.getItem('disclaimerSeen')) {
            document.getElementById('disclaimerModal').style.display = 'flex';
        }

        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.querySelector(`.nav-item[onclick*="news"]`).classList.add('active');
        document.getElementById('tab-news').classList.add('active');

    };

    async function ensureUserDoc(user) {
      const ur = doc(db, "users", user.uid);
      const s = await getDoc(ur);
      if (!s.exists()) {
        const referredBy = localStorage.getItem('referredBy') || null;
        await setDoc(ur, { 
          name: user.displayName||"Ù…Ø³ØªØ®Ø¯Ù…", 
          email: user.email, 
          walletBalance: 0, 
          uid: user.uid, 
          referredBy: referredBy,
          teamTotalEarnings: 0,
          createdAt: serverTimestamp(),
        });
      }
    }

    async function refreshUserData() {
        if(!currentUser || isGuest) return;
        const s = await getDoc(doc(db,"users",currentUser.uid));
        if(s.exists()) {
            const data = s.data();
            document.getElementById('walletAmount').textContent = Number(data.walletBalance).toFixed(2);
            document.getElementById('walletHeader').textContent = Number(data.walletBalance).toFixed(2);
            document.getElementById('userNameTag').textContent = data.name;
            document.getElementById('profileName').value = data.name;
            document.getElementById('profileId').value = data.uid;
            document.getElementById('profileEmail').value = data.email;
            
            const teamEarn = data.teamTotalEarnings || 0;
            document.getElementById('teamEarnings').innerText = teamEarn.toFixed(2);
            document.getElementById('referralLink').value = `${window.location.origin}/?ref=${data.uid}`;

            const qTeam = query(collection(db, "users"), where("referredBy", "==", currentUser.uid));
            const snapTeam = await getDocs(qTeam);
            const count = snapTeam.size;
            document.getElementById('teamCount').innerText = count;

            const walletInput = document.getElementById('profileWallet');
            const saveBtn = document.getElementById('saveWalletBtn');
            if (data.walletAddress) {
              walletInput.value = data.walletAddress;
              walletInput.readOnly = true;
              walletInput.style.backgroundColor = "rgba(30, 41, 59, 0.5)";
              walletInput.style.color = "#4ade80";
              saveBtn.style.display = 'none';
            } else {
              walletInput.value = "";
              walletInput.readOnly = false;
              walletInput.style.backgroundColor = "#020617";
              walletInput.style.color = "#fff";
              saveBtn.style.display = 'block';
            }
        }
    }

    loginBtn.onclick = async () => { 
        authMsg.textContent = "";
        try { 
            await signInWithEmailAndPassword(auth, document.getElementById('authEmail').value, document.getElementById('authPassword').value); 
        } catch(e){ authMsg.textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„."; } 
    };
    
    doRegisterBtn.onclick = async () => { 
      authMsg.textContent = "";
      try { 
        const email = document.getElementById('authEmail').value;
        const pass = document.getElementById('authPassword').value;
        const name = document.getElementById('authName').value;
        
        if(!pass || pass.length < 6) { authMsg.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‚ØµÙŠØ±Ø©."; return; }

        const c = await createUserWithEmailAndPassword(auth, email, pass);
        await updateProfile(c.user, {displayName: name});
        
        const referredBy = localStorage.getItem('referredBy') || null;

        await setDoc(doc(db, "users", c.user.uid), {
          name: name, email: email,
          walletBalance: 0, uid: c.user.uid, 
          referredBy: referredBy, teamTotalEarnings: 0,
          createdAt: serverTimestamp()
        });
      } catch(e){ authMsg.textContent = e.message; } 
    };

    googleAuthBtn.onclick = async () => {
        authMsg.textContent = "";
        try { await signInWithPopup(auth, googleProvider); } catch (error) { authMsg.textContent = "ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„."; }
    };

    document.getElementById('logoutBtn').onclick = () => {
        if(isGuest) location.reload();
        else signOut(auth);
    };

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        isGuest = false;
        authScreen.style.display = 'none';
        await ensureUserDoc(user);
        await refreshUserData();
        await loadNews();
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„ØªÙ†ÙˆÙŠÙ‡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø¬Ù„ Ø£ÙŠØ¶Ø§Ù‹
        if (!localStorage.getItem('disclaimerSeen')) {
            document.getElementById('disclaimerModal').style.display = 'flex';
        }
      } else if (!isGuest) {
        authScreen.style.display = 'flex';
      }
      loadingOverlay.style.display = 'none'; 
      if (document.querySelectorAll('.page-section.active').length === 0) {
        document.getElementById('tab-news').classList.add('active');
      }
    });

    // ØªÙ… Ø­Ø°Ù Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ© startFakeNotifications
  </script>
</body>
</html>
